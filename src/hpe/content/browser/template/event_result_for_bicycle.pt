<style>
td{
    text-align: center;
    vertical-align: middle !important;
}
th{
    vertical-align: middle !important;
}
</style>
<button style="float:right;margin-bottom:25px;font-size:18px" class="award" id="complete">審核通過</button>
<button style="float:right;margin-bottom:25px;font-size:18px;margin-right:20px" class="award" id="foot_power">腿力滿檔獎</button>
<button style="float:right;margin-bottom:25px;font-size:18px;margin-right:20px" class="award" id="city">城市攻略獎</button>

<table>
    <tr>
        <th style="width:50px">上傳順序</th>
        <th style="width:95px;">會員ID</th>
        <th style="width:95px;">信箱</th>
        <th style="width:95px;">中文姓名</th>
        <th style="width:100px;">手機號碼</th>
        <th style="width:100px;">上傳日期</th>
        <th style="width:100px">地點</th>
        <th style="width:95px;">額外申請</th>
        <th style="width:300px">圖片</th>
        <th style="width:80px"></th>
    </tr>
        <tr tal:repeat="data view/data">
            <td tal:content="repeat/data/number"></td>
            <td>${python:data[0]}</td>
            <td>${python:data[1]}</td>
            <td>${python:data[2]}</td>
            <td>${python:data[5]}</td>
            <td>${python:data[10]}</td>
            <td>${python:data[7]}</td>
            <td>${python:data[8]}</td>
            <td>
                <a href="${python: 'data:image/png;base64,%s' %data[9]}" target="_blank">
                    <img src="${python: 'data:image/png;base64,%s' %data[9]}" style="height:350px;width:350px">
                </a>
            </td>
            <td>
                <input type='checkbox' data-id="${python: data[12]}" 
                    style="width:20px;height:20px" tal:condition="python: data[11] == 0">
                <p style="color:green" tal:condition="python: data[11] == 1">通過</p>
            </td>
        </tr>

</table>

<script>
$(function(){
    $('.award').click(function(){
        id_list = []
        $("input[type='checkbox']:checked").each(function(){
            id_list.push($(this).data('id'))
        })
        url = location.href.replace('show_activity_status', 'update_bicycle_picture')

        data = {
            'id_list': id_list,
            'award': this.id
        }
        $.ajax({
            type: "post",
            url: url,
            data: data,
            success: function (rep) {
                if(rep == 'success'){
                    alert('更新成功,畫面正在更新')
                    url = location.href.replace('show_activity_status', 'get_event_data')
                    $.ajax({
                        type: 'post',
                        url: url,
                        data: {'event': '樂活騎單車', 'date': 'audit'},
                        success: function(response){
                            $('.response_data').html(response)
                        }
                    })
                }else{
                    alert('更新失敗')
                }
            }
        });
    })
})

</script>
